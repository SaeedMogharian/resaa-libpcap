# Transparent Node  
**نمای کلی**

این پروژه ابزارهایی برای ضبط، تغییر و تزریق بسته‌های شبکه در دو رابط شبکه فراهم می‌کند. این ابزارها هم از ضبط و تزریق بسته‌های دوطرفه (wire.cpp) و هم از تغییر مسیر یک‌طرفه بسته‌ها با تغییر IP مقصد (ip-redirector.cpp) پشتیبانی می‌کنند. این ابزارها از کتابخانه PcapPlusPlus برای پردازش بسته‌های شبکه استفاده می‌کنند.

## کتابخانه PcapPlusPlus

کتابخانه PcapPlusPlus یک پوشش c++ برای چند موتور مختلف دیگر در پتلفرم‌های مختلف است که برای ضبط، تجزیه و ایجاد بسته‌های شبکه طراحی شده است. این کتابخانه کارآمد، قدرتمند و استفاده از آن ساده است.

برای اطلاعات بیشتر، مستندات رسمی را مطالعه کنید:  
[https://pcapplusplus.github.io/docs/features](https://pcapplusplus.github.io/docs/features)

دستورالعمل‌های ساخت:

مخزن PcapPlusPlus را کلون کنید:

```bash
git clone --depth 1 https://github.com/seladb/PcapPlusPlus.git
```

برای دستورالعمل‌های دقیق‌تر ساخت، راهنمای رسمی را دنبال کنید: [راهنمای نصب](https://pcapplusplus.github.io/docs/installation/)

## کدها

### کد **wire.cpp**

این برنامه بسته‌ها را به‌صورت دوطرفه بین دو رابط ضبط می‌کند و بسته‌ها را از یک رابط به رابط دیگر تزریق می‌کند. همچنین آمار زنده از ترافیک IP، شامل تعداد بسته‌ها و بایت‌ها و همچنین نرخ موفقیت تزریق بسته‌ها را ارائه می‌دهد.

#### ویژگی‌های کلیدی wire.cpp:

- **تزریق دوطرفه بسته‌ها**: بسته‌ها را از یک رابط ضبط کرده و به رابط دیگر تزریق می‌کند.
- **آمار ترافیک IP**: تعداد بسته‌ها و بایت‌های ارسال‌شده و دریافت‌شده از هر آدرس IP را در هر دو رابط ردیابی می‌کند.
- **ردیابی شکست تزریق**: تعداد شکست‌های تزریق را شمارش کرده و نرخ موفقیت تزریق بسته‌ها را محاسبه می‌کند.

#### اجزای اصلی:

- **کلاس Stats**: آمار مربوط به تعداد بسته‌ها و بایت‌های ارسال‌شده برای هر آدرس IP را مدیریت می‌کند.
- **کال‌بک تزریق**: تزریق بسته‌ها از یک رابط به رابط دیگر را مدیریت کرده و آمار را به‌روزرسانی می‌کند.
- **مدیریت سیگنال‌ها**: سیگنال‌های خاتمه (مانند Ctrl+C) را به‌صورت مؤثر مدیریت می‌کند تا حلقه ضبط و تزریق را متوقف کند.

### کد ip-redirector.cpp

این ابزار بسته‌ها را از یک رابط ضبط کرده، آدرس IP مقصد هر بسته را به آدرس IP رابط دیگر تغییر می‌دهد و سپس آن‌ها را دوباره به شبکه تزریق می‌کند. این ابزار می‌تواند برای تغییر مسیر ترافیک بین دو رابط استفاده شود.

#### ویژگی‌های کلیدی ip-redirector.cpp:

- **تغییر مسیر یک‌طرفه بسته‌ها**: بسته‌ها را از یک رابط ضبط کرده و آدرس IP مقصد را به آدرس IP رابط هدف تغییر می‌دهد.
- **آمار ترافیک IP**: مشابه wire.cpp، تعداد بسته‌ها و بایت‌های ارسال‌شده را برای هر آدرس IP ردیابی می‌کند.
- **ردیابی شکست تزریق**: مشابه wire.cpp، شکست‌های تزریق را ردیابی کرده و نرخ موفقیت تغییر مسیر بسته‌ها را محاسبه می‌کند.

#### اجزای اصلی:

- **کلاس Stats**: آمار بسته‌ها و بایت‌ها را برای هر آدرس IP ردیابی می‌کند.
- **کال‌بک تزریق**: آدرس IP مقصد هر بسته ضبط‌شده را به آدرس IP رابط دوم تغییر داده و آن را دوباره تزریق می‌کند.
- **مدیریت سیگنال‌ها**: اجازه می‌دهد برنامه به‌طور مؤثر با استفاده از Ctrl+C خاتمه یابد.

### نحوه استفاده
پروژه را به صورت زیر کامپایل کنید:
```bash
mkdir build
cd build
cmake ..
cmake build .
```

برای اجرای برنامه از دستور زیر استفاده کنید: در پوشه `build`

#### انتقال دو طرفه بسته‌ها wire

```bash
./wire -i <primary_interface> -j <secondary_interface> [BPF filter]
```

- `-i <primary_interface>`: نام رابط شبکه اصلی را مشخص کنید (مثلاً ens192).
- `-j <secondary_interface>`: نام رابط شبکه ثانویه را مشخص کنید (مثلاً ens160).
- `[BPF filter]`: عبارت اختیاری فیلتر Berkeley Packet Filter (BPF) برای فیلتر کردن بسته‌های ضبط‌شده (مثلاً tcp یا port 80).


این دستور بسته‌ها را به صورت دو طرفه بین  ens160 و ens192 انتقال داده و آمار زنده را نمایش می‌دهد.

#### تغییر مسیر یک‌طرفه بسته‌ها - ip-redirector

برای اجرای برنامه تغییر مسیر بسته‌ها از دستور زیر استفاده کنید:

```bash
./ip-redirector -i <primary_interface> -j <secondary_interface> [BPF filter]
```

- `-i <primary_interface>`: نام رابط اصلی که بسته‌ها از آن ضبط می‌شوند.
- `-j <secondary_interface>`: نام رابط ثانویه که بسته‌ها به آن تغییر مسیر می‌یابند.
- `[BPF filter]`: عبارت اختیاری BPF برای فیلتر کردن بسته‌ها.

این دستور بسته‌ها را از eth0 ضبط کرده، آدرس IP مقصد آن‌ها را به IP رابط eth1 تغییر می‌دهد و دوباره به شبکه تزریق می‌کند.

#### آمار

هر دو ابزار (wire.cpp و ip-redirector.cpp) آمار زنده در حین اجرا نمایش می‌دهند، که شامل موارد زیر است:

- **آمار IP**: تعداد بسته‌ها و بایت‌های ارسال‌شده برای هر آدرس IP مبدا در رابط‌های اصلی و ثانویه.
- **آمار تزریق**: تعداد تزریق‌های موفق و ناموفق بسته‌ها و نرخ موفقیت.

#### نمونه خروجی:
```
Live Statistics Report:

IP Statistics On Interface: ens160
IP               Packets Sent   Bytes Sent  
192.168.20.1     2              2556        
0.0.0.0          20             25560       
192.168.20.86    53             20198       

IP Statistics On Interface: ens192
IP               Packets Sent   Bytes Sent  
-                -              -           

Injection Statistics:
ReceivedOnInterface   PacketsInjectedFrom  Failures  SuccessRate (%)
ens160                75                   0         100
ens192                0                    0         100

```